namespace = vn_flavor_geo

# the Seljuk Yoke starts
country_event = {
	id = vn_flavor_geo.1
	title = "vn_flavor_geo.1.t"
	desc = "vn_flavor_geo.1.d"
	picture = TRIBUTE_TO_TATARS_eventPicture
	
	fire_only_once = yes
	major = yes

	major_trigger = {
		tag = SJK
	}

	trigger = {
		tag = GEO
		NOT = { started_in = 1080.6.24 }
		current_age = age_of_empire
		BYZ = {
			has_country_flag = manzikert_happened
		}
		SJK = {
			exists = yes
			is_subject = no
			if = {
				limit = {
					OR = {
						has_dlc = "Emperor"
						has_dlc = "Rights of Man"
					}
				}
				is_great_power = yes
			}
			else = {
				total_own_and_non_tributary_subject_development = 300
			}
			NOT = { alliance_with = ROOT }
			NOT = { has_disaster = seljuk_collapse }
			NOT = { has_country_flag = had_seljuk_collapse }
		}
	}

	mean_time_to_happen = {
		months = 60
		modifier = {
			factor = 0.9
			is_year = 1075
		}
		modifier = {
			factor = 0.9
			is_year = 1080
		}
		modifier = {
			factor = 0.9
			is_year = 1085
		}
		modifier = {
			factor = 0.9
			is_year = 1090
		}
	}

	option = {
		name = "vn_flavor_geo.1.a"
		add_stability = -1
		add_country_modifier = {
			name = seljuk_yoke_mod
			duration = -1
			desc = seljuk_yoke_mod.tt
		}
		custom_tooltip = vn_flavor_geo.1.tt
	}
}

# tribute
country_event = {
	id = vn_flavor_geo.2
	title = "vn_flavor_geo.2.t"
	desc = "vn_flavor_geo.2.d"
	picture = TRIBUTE_TO_TATARS_eventPicture

	is_triggered_only = yes

	trigger = {
		has_country_modifier = seljuk_yoke_mod
		SJK = {
			exists = yes
			NOT = { war_with = ROOT }
			NOT = { alliance_with = ROOT }
		}
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			export_to_variable = {
				which = georgian_tribute
				value = monthly_income
				who = ROOT
			}
			multiply_variable = {
				which = georgian_tribute
				value = 3
			}
			export_to_variable = {
				which = georgian_tribute_half
				value = monthly_income
				who = ROOT
			}
			multiply_variable = {
				which = georgian_tribute_half
				value = 1.5
			}
		}
	}

	option = {
		name = vn_flavor_geo.2.a
		ai_chance = {
			factor = 90
		}
		custom_tooltip = vn_flavor_geo.2.tt
		hidden_effect = {
			SJK = {
				country_event = {
					id = vn_flavor_geo.3
					days = 1
				}
			}
		}
	}

	option = {
		name = vn_flavor_geo.2.b
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				is_at_war = yes
			}
			modifier = {
				factor = 0.1
				NOT = {
					military_strength = {
						who = SJK
						value = 1
					}
				}
			}
			modifier = {
				factor = 1.5
				military_strength = {
					who = SJK
					value = 1.5
				}
			}
			modifier = {
				factor = 1.1
				AND = {
					army_size = 10
					army_size_percentage = 0.9
				}
			}
			modifier = {
				factor = 1.1
				AND = {
					manpower = 10
					manpower_percentage = 0.9
				}
			}
			modifier = {
				factor = 1.1
				num_of_generals = 2
			}
			modifier = {
				factor = 1.1
				ruler_has_personality = conqueror_personality
			}
			modifier = {
				factor = 0.9
				ruler_has_personality = craven_personality
			}
			modifier = {
				factor = 0.2
				NOT = { manpower_percentage = 0.5 }
			}
			modifier = {
				factor = 0.2
				war_exhaustion = 1
			}
			modifier = {
				factor = 0.8
				NOT = { personality = ai_militarist }
			}
			modifier = {
				factor = 0.8
				NOT = { stability = 1 }
			}
		}
		custom_tooltip = vn_flavor_geo.2.tt2
		hidden_effect = {
			SJK = {
				country_event = {
					id = vn_flavor_geo.4
					days = 1
				}
			}
		}
	}
}

# geo pays tribute
country_event = {
	id = vn_flavor_geo.3
	title = vn_flavor_geo.3.t
	desc = vn_flavor_geo.3.d
	picture = FEAST_eventPicture

	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			export_to_variable = {
				which = georgian_tribute
				value = monthly_income
				who = FROM
			}
			multiply_variable = {
				which = georgian_tribute
				value = 3
			}
		}
	}

	option = {
		name = vn_flavor_geo.3.a
		transfer_treasury = {
			giver = FROM
			taker = ROOT
			variable = georgian_tribute
			custom_tooltip = vn_flavor_geo.3.tt
		}
	}
}

# geo does not pay tribute
country_event = {
	id = vn_flavor_geo.4
	title = vn_flavor_geo.4.t
	desc = vn_flavor_geo.4.d
	picture = ACCUSATION_eventPicture

	is_triggered_only = yes

	option = {
		name = vn_flavor_geo.4.a
		ai_chance = {
			factor = 1
		}
		mil_power_cost = 50
		add_yearly_manpower = -0.25
		custom_tooltip = vn_flavor_geo.4.tt
		hidden_effect = {
			FROM = {
				country_event = {
					id = vn_flavor_geo.5
				}
			}
		}
	}

	option = {
		name = vn_flavor_geo.4.b
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 90
				}
			}
			modifier = {
				factor = 0.1
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 80
				}
			}
			modifier = {
				factor = 0.3
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 70
				}
			}
			modifier = {
				factor = 0.5
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 60
				}
			}
			modifier = {
				factor = 0.7
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 50
				}
			}
			modifier = {
				factor = 1.2
				NOT = {
					has_government_power = { 
						mechanic_type = ottoman_decadence_mechanic
						power_type = ottoman_decadence
						value = 50
					}
				}
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 40
				}
			}
			modifier = {
				factor = 1.5
				NOT = {
					has_government_power = { 
						mechanic_type = ottoman_decadence_mechanic
						power_type = ottoman_decadence
						value = 40
					}
				}
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 30
				}
			}
			modifier = {
				factor = 1.7
				NOT = {
					has_government_power = { 
						mechanic_type = ottoman_decadence_mechanic
						power_type = ottoman_decadence
						value = 30
					}
				}
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 20
				}
			}
			modifier = {
				factor = 2
				NOT = {
					has_government_power = { 
						mechanic_type = ottoman_decadence_mechanic
						power_type = ottoman_decadence
						value = 20
					}
				}
				has_government_power = { 
					mechanic_type = ottoman_decadence_mechanic
					power_type = ottoman_decadence
					value = 10
				}
			}
			modifier = {
				factor = 100
				NOT = {
					has_government_power = { 
						mechanic_type = ottoman_decadence_mechanic
						power_type = ottoman_decadence
						value = 10
					}
				}
			}
		}
		if = {
			limit = {
				has_government_mechanic = ottoman_decadence_mechanic
			}
			add_government_power = { 
				mechanic_type = ottoman_decadence_mechanic
				power_type = ottoman_decadence
				value = 2.5
			}
		}
		else = {
			add_legitimacy = -5
			add_prestige = -5
		}
	}
}

#rebels spawn if no tribute was payed
country_event = {
	id = vn_flavor_geo.5
	title = vn_flavor_geo.5.t
	desc = vn_flavor_geo.5.d
	picture = ANGRY_MOB_eventPicture
	goto = geo_revolt

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					any_owned_province = {
						is_capital = no
						can_spawn_rebels = nationalist_rebels
						any_core_country = {
							exists = no
							culture_group = caucasian
						}
					}
				}
				random_owned_province = {
					limit = {
						is_capital = no
						can_spawn_rebels = nationalist_rebels
						any_core_country = {
							exists = no
							culture_group = caucasian
						}
					}
					save_event_target_as = geo_revolt
					random_core_country = {
						limit = {
							exists = no
							culture_group = caucasian
						}
						save_event_target_as = geo_revolt_tag
					}
				}
			}
			else = {
				random_owned_province = {
					save_event_target_as = geo_revolt
				}
			}
		}
	}

	option = {
		name = vn_flavor_geo.5.a
		event_target:geo_revolt = {
			if = {
				limit = {
					ROOT = { total_development = 300 }
				}
				spawn_rebels = {
					size = 4
					type = nationalist_rebels
					friend = event_target:geo_revolt_tag
					win = yes
				}
			}
			else_if = {
				limit = {
					ROOT = { total_development = 200 }
				}
				spawn_rebels = {
					size = 3
					type = nationalist_rebels
					friend = event_target:geo_revolt_tag
					win = yes
				}
			}
			else_if = {
				limit = {
					ROOT = { total_development = 100 }
				}
				spawn_rebels = {
					size = 2
					type = nationalist_rebels
					friend = event_target:geo_revolt_tag
					win = yes
				}
			}
			else = {
				spawn_rebels = {
					size = 1
					type = nationalist_rebels
					friend = event_target:geo_revolt_tag
					win = yes
				}
			}
		}
	}

	after = {
		clear_saved_name = geo_prince
	}
}

#end of the seljuk yoke
country_event = {
	id = vn_flavor_geo.6
	title = vn_flavor_geo.6.t
	desc = vn_flavor_geo.6.d
	desc = {
		trigger = { has_country_flag = geo_defeated_sjk_in_war }
		desc = vn_flavor_geo.6.d
	}
	desc = {
		trigger = { NOT = { has_country_flag = geo_defeated_sjk_in_war} }
		desc = vn_flavor_geo.6.d2
	}
	picture = GOOD_WITH_MONARCH_eventPicture

	fire_only_once = yes
	is_triggered_only = yes

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = vn_flavor_geo.6.a
		add_prestige = 10
		remove_country_modifier = seljuk_yoke_mod
	}
}

#David the Builder
country_event = {
	id = vn_flavor_geo.7
	title = vn_flavor_geo.7.t
	desc = vn_flavor_geo.7.d
	picture = REFORM_eventPicture

	fire_only_once = yes
	
	trigger = {
		tag = GEO
		current_age = age_of_empire
		government = monarchy
		dynasty = "Bagrationi"
		is_lesser_in_union = no
		NOT = { started_in = 1073.1.1 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			has_regency = yes
		}
	}
	
	option = {
		name = vn_flavor_geo.7.a
		define_ruler = {
			name = "Davit IV"
			dynasty = "Bagrationi"
			adm = 6
			dip = 5
			mil = 6
			age = 16
		}
		hidden_effect = {
			add_ruler_personality = silver_tongue_personality
			add_ruler_personality = tactical_genius_personality
			add_ruler_personality = lawgiver_personality
		}
		if = {
			limit = {
				has_states_general_mechanic = yes
			}
			change_statists_vs_orangists = 1
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					ruler_total_stats = {
						amount = 15
					}
				}
			}
		}
	}
	
	option = {
		name = vn_flavor_geo.7.b
		add_legitimacy = 10
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				ruler_total_stats = {
					amount = 15
				}
			}
			modifier = {
				factor = 0
				has_regency = yes
			}
		}
	}
}